(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{135:function(e,t,n){e.exports=n(151)},139:function(e,t,n){},151:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(13),i=n.n(c),l=(n(139),n(57)),o=n(127),s=n(128),u=n(125),m=n(17),d=n(21),p=n(24),f="",h=function(){return f},g=function(e){f=e},E=n(129),v=n(114),y=n.n(v),b=n(29),w=n.n(b),O=n(38),N=n(19),j=n(3),x=n(56),S=n(103),C=n(117),k=n(42),q=n(43),T=n.n(q),F=n(26);function A(){var e=Object(k.a)(["\n    query Users {\n  users {\n    id\n    email\n    firstName\n    lastName\n  }\n}\n    "]);return A=function(){return e},e}function $(){var e=Object(k.a)(["\n    mutation Register($email: String!, $password: String!, $firstName: String!, $lastName: String!, $dateOfBirth: String!, $streetAddress: String!, $postCode: String!, $city: String!, $country: String!) {\n  register(email: $email, password: $password, firsName: $firstName, lastName: $lastName, dateOfBirth: $dateOfBirth, streetAddress: $streetAddress, postCode: $postCode, city: $city, country: $country)\n}\n    "]);return $=function(){return e},e}function B(){var e=Object(k.a)(["\n    query Me {\n  me {\n    id\n    email\n    firstName\n    lastName\n  }\n}\n    "]);return B=function(){return e},e}function P(){var e=Object(k.a)(["\n    mutation Logout {\n  logout\n}\n    "]);return P=function(){return e},e}function L(){var e=Object(k.a)(["\n    mutation Login($email: String!, $password: String!) {\n  login(email: $email, password: $password) {\n    accessToken\n    user {\n      id\n      email\n      firstName\n      lastName\n    }\n  }\n}\n    "]);return L=function(){return e},e}function D(){var e=Object(k.a)(["\n    query Hello {\n  hello\n}\n    "]);return D=function(){return e},e}function R(){var e=Object(k.a)(["\n    mutation CreateAccount($currency: String!) {\n  createAccount(currency: $currency)\n}\n    "]);return R=function(){return e},e}function U(){var e=Object(k.a)(["\n    query Bye {\n  bye\n}\n    "]);return U=function(){return e},e}function I(){var e=Object(k.a)(["\n    query Accounts {\n  accounts {\n    id\n    balance\n    currency\n  }\n}\n    "]);return I=function(){return e},e}var M=T()(I());T()(U());var Q=T()(R());T()(D());var V=T()(L());var Y=T()(P());var G=T()(B());var H=T()($());var J=T()(A());var _,z=function(){return r.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},r.a.createElement("img",{src:"loading.svg",alt:"Loading...",style:{height:"124px"}}))},K=function(){var e,t=(e={fetchPolicy:"network-only"},F.c(J,e)).data;return t?r.a.createElement("div",null,r.a.createElement("div",null,"users: "),r.a.createElement("ul",null,t.users.map((function(e){return r.a.createElement("li",{key:e.id},e.id,", ",e.email,", ",e.firstName," ",e.lastName)})))):r.a.createElement(z,null)},W=n(54),X=n(188),Z=n(183),ee=n(189),te=n(126);!function(e){e.PRIMARY="#2196f3"}(_||(_={}));var ne=Object(te.a)({palette:{primary:{main:_.PRIMARY},contrastThreshold:3,tonalOffset:.2}}),ae=n(14),re=ae.c({firstName:ae.e().required("First name is required"),lastName:ae.e().required("Last name is required"),email:ae.e().email().required("Email is required"),streetAddres:ae.e().required("Street address is required"),postCode:ae.e().required("Post code is required"),city:ae.e().required("City is required"),country:ae.e().required("Country is required"),password:ae.b((function(e){return e?ae.e().min(6,"Password must be at least 6 characters").required("Password is required"):ae.e()})),confirmPassword:ae.e().oneOf([ae.d("password")],"Passwords do not match"),dateOfBirth:ae.a().required("Date of birth is required")}),ce=n(184),ie=n(193),le=function(e){var t=e.placeholder,n=e.className,a=e.type,c=Object(j.a)(e,["placeholder","className","type"]),i=Object(W.c)(c),l=Object(N.a)(i,2),o=l[0],s=l[1],u=s.error&&s.touched?s.error:"";return r.a.createElement(Z.a,{theme:ne},r.a.createElement(ce.a,null),r.a.createElement(ie.a,Object.assign({className:n,type:a,variant:"standard",required:!0,placeholder:t},o,{helperText:u,error:!!u})))},oe=n(194),se=function(e){var t=e.message;return r.a.createElement(oe.a,{variant:"outlined",severity:"error"},t)},ue=Object(X.a)({headerText:{textAlign:"center"},root:{display:"flex",justifyContent:"center",width:"420px",margin:"0 auto"},alignedFormContent:{marginTop:12,display:"flex",width:"100%"},alignedFormField:{width:"50%",marginRight:8},formField:{width:"411px",marginRight:8,marginTop:12},formButton:{marginTop:12,textAlign:"center"},loginText:{margintop:12}}),me=function(e){var t,n=e.history,c=F.b(H,t),i=Object(N.a)(c,1)[0],l=Object(a.useState)(""),o=Object(N.a)(l,2),s=o[0],u=o[1],m=ue();return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("h1",{className:m.headerText},"Sign Up")),s.length>0&&r.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},r.a.createElement(se,{message:s})),r.a.createElement(W.b,{initialValues:{firstName:"",lastName:"",streetAddres:"",postCode:"",city:"",country:"",email:"",password:"",confirmPassword:"",dateOfBirth:""},validationSchema:re,onSubmit:function(){var e=Object(O.a)(w.a.mark((function e(t,a){var r,c,l,o;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=a.setSubmitting,l=a.resetForm,c(!0),e.next=4,i({variables:{firstName:t.firstName,lastName:t.lastName,email:t.email,password:t.password,streetAddress:t.streetAddres,postCode:t.postCode,city:t.city,country:t.country,dateOfBirth:t.dateOfBirth}});case 4:o=e.sent,(null===(r=o.data)||void 0===r?void 0:r.register)?(n.push("/login"),c(!1),l()):(u("User with that email already exists."),c(!1));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},(function(e){var t=e.isSubmitting;return r.a.createElement("div",{className:m.root},r.a.createElement(W.a,{onChange:function(){return u("")}},r.a.createElement("div",{className:m.alignedFormContent},r.a.createElement(le,{className:m.alignedFormField,name:"firstName",placeholder:"First name",type:"input"}),r.a.createElement(le,{className:m.alignedFormField,name:"lastName",placeholder:"Last name",type:"input"})),r.a.createElement("div",null,r.a.createElement(le,{className:m.formField,name:"streetAddres",placeholder:"Street address",type:"input"}),r.a.createElement(le,{className:m.formField,name:"postCode",placeholder:"Post code",type:"input"}),r.a.createElement("div",{className:m.alignedFormContent},r.a.createElement(le,{className:m.alignedFormField,name:"city",placeholder:"City",type:"input"}),r.a.createElement(le,{className:m.alignedFormField,name:"country",placeholder:"Country",type:"input"})),r.a.createElement(le,{className:m.formField,name:"email",placeholder:"Email",type:"input"}),r.a.createElement(le,{className:m.formField,name:"password",placeholder:"Password",type:"password"}),r.a.createElement(le,{className:m.formField,name:"confirmPassword",placeholder:"Confirm password",type:"password"}),r.a.createElement(le,{className:m.formField,name:"dateOfBirth",type:"date"})),r.a.createElement("div",{className:m.formButton},r.a.createElement(Z.a,{theme:ne},r.a.createElement(ee.a,{disabled:t,variant:"contained",color:"primary",type:"submit",style:{marginTop:12}},"Sign Up"))),r.a.createElement("div",{className:m.loginText},r.a.createElement("p",null,"Already have an account? ",r.a.createElement("a",{href:"/login"},"Login here.")))))})))},de=ae.c({email:ae.e().email().required("Email is required"),password:ae.b((function(e){return e?ae.e().min(6,"Password must be at least 6 characters").required("Password is required"):ae.e()}))}),pe=Object(X.a)({headerText:{textAlign:"center"},root:{display:"flex",justifyContent:"center",width:"420px",margin:"0 auto"},formField:{width:"411px",marginRight:8,marginTop:12},formButton:{marginTop:12,textAlign:"center"},registerText:{marginTop:12}}),fe=function(e){var t,n=e.history,c=F.b(V,t),i=Object(N.a)(c,1)[0],l=Object(a.useState)(""),o=Object(N.a)(l,2),s=o[0],u=o[1],m=pe();return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("h1",{className:m.headerText},"Login")),s.length>0&&r.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},r.a.createElement(se,{message:s})),r.a.createElement(W.b,{initialValues:{email:"",password:""},validationSchema:de,onSubmit:function(){var e=Object(O.a)(w.a.mark((function e(t,a){var r,c,l,o;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.setSubmitting,c=a.resetForm,r(!0),e.prev=2,e.next=5,i({variables:{email:t.email,password:t.password},update:function(e,t){var n=t.data;if(!n)return null;e.writeQuery({query:G,data:{me:n.login.user}})}});case 5:(l=e.sent)&&l.data&&(g(l.data.login.accessToken),n.push("/accounts"),r(!1),c()),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(2),o=e.t0.message.split(":")[1],u(o),r(!1);case 14:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n){return e.apply(this,arguments)}}()},(function(e){var t=e.isSubmitting;return r.a.createElement("div",{className:m.root},r.a.createElement(W.a,null,r.a.createElement("div",null,r.a.createElement(le,{className:m.formField,name:"email",placeholder:"Email",type:"input"}),r.a.createElement(le,{className:m.formField,name:"password",placeholder:"Password",type:"password"})),r.a.createElement("div",{className:m.formButton},r.a.createElement(Z.a,{theme:ne},r.a.createElement(ee.a,{disabled:t,variant:"contained",color:"primary",type:"submit",style:{marginTop:12}},"Login"))),r.a.createElement("div",{className:m.registerText},r.a.createElement("p",null,"Don't have an account? ",r.a.createElement("a",{href:"/register"},"Sign up here.")))))})))},he=n(190),ge=n(191),Ee=n(192),ve=Object(X.a)({root:{flexGrow:1},title:{flexGrow:1}}),ye=function(){var e,t=F.c(G,e),n=t.data,c=t.loading,i=function(e){return F.b(Y,e)}(),l=Object(N.a)(i,2),o=l[0],s=l[1].client,u=Object(a.useState)(!1),m=Object(N.a)(u,2),d=m[0],p=m[1],f=Object(x.g)(),h=ve();Object(a.useEffect)((function(){!c&&n&&n.me?p(!0):p(!1)}),[n,c]);return r.a.createElement("div",{className:h.root},r.a.createElement(Z.a,{theme:ne},r.a.createElement(he.a,{position:"static"},r.a.createElement(ge.a,null,r.a.createElement(Ee.a,{className:h.title,variant:"h6"},"Apollo"),d?r.a.createElement("div",null,r.a.createElement(ee.a,{color:"inherit",onClick:function(e){e.preventDefault(),f.push("/accounts")}},"Accounts"),r.a.createElement(ee.a,{color:"inherit",onClick:Object(O.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o().then((function(){return f.push("/")}));case 2:return g(""),e.next=5,s.resetStore();case 5:case"end":return e.stop()}}),e)})))},"Logout")):r.a.createElement("div",null,r.a.createElement(ee.a,{color:"inherit",onClick:function(e){e.preventDefault(),f.push("/login")}},"Login"),r.a.createElement(ee.a,{color:"inherit",onClick:function(e){e.preventDefault(),f.push("/register")}},"Sign Up"))))))},be=Object(X.a)({root:{display:"flex",alignItems:"center",textalign:"center",flexDirection:"column"},newAccountButton:{position:"absolute",right:20,marginTop:10}}),we=function(){var e,t=F.c(M,e),n=t.data,c=t.loading,i=function(e){return F.b(Q,e)}(),l=Object(N.a)(i,1)[0],o=Object(a.useState)(""),s=Object(N.a)(o,2),u=s[0],m=s[1],d=be();return Object(a.useEffect)((function(){}),[c,n]),n?r.a.createElement("div",{className:d.root},r.a.createElement("div",null,r.a.createElement("h2",null,"Accounts")),u.length>0&&r.a.createElement("div",{style:{display:"flex",justifyContent:"center"}},r.a.createElement(se,{message:u})),r.a.createElement("div",{className:d.newAccountButton},r.a.createElement(Z.a,{theme:ne},r.a.createElement(ee.a,{variant:"contained",color:"primary",type:"submit",onClick:function(){var e=Object(O.a)(w.a.mark((function e(t){var n,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),"BTC",e.prev=2,e.next=5,l({variables:{currency:"BTC"},refetchQueries:[{query:M,variables:{}}]});case 5:(n=e.sent)&&n.data&&console.log("working..."),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),a=e.t0.message.split(":")[1],m(a);case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}()},"+ New"))),r.a.createElement("div",null,r.a.createElement("ul",null,n.accounts.map((function(e){return r.a.createElement("li",{key:e.id},e.currency," ",e.balance)}))))):r.a.createElement(z,null)},Oe=function(e){var t=e.component,n=Object(j.a)(e,["component"]);return r.a.createElement(x.b,Object.assign({},n,{render:function(e){return h()?r.a.createElement(t,e):r.a.createElement(x.a,{to:{pathname:"/login"}})}}))},Ne=function(e){var t=e.component,n=Object(j.a)(e,["component"]);return r.a.createElement(x.b,Object.assign({},n,{render:function(e){return h()?r.a.createElement(x.a,{to:{pathname:"/accounts"}}):r.a.createElement(t,e)}}))},je=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(C.Helmet,null,r.a.createElement("style",null,"body { background-color: snow; }")),r.a.createElement(S.a,null,r.a.createElement("div",null,r.a.createElement(ye,null),r.a.createElement(x.d,null,r.a.createElement(x.b,{exact:!0,path:"/",component:K}),r.a.createElement(Ne,{exact:!0,path:"/register",component:me}),r.a.createElement(Ne,{exact:!0,path:"/login",component:fe}),r.a.createElement(Oe,{exact:!0,path:"/accounts",component:we})))))},xe=new o.a({}),Se=new m.a((function(e,t){return new d.a((function(n){var a;return Promise.resolve(e).then((function(e){var t=h();e.setContext({headers:{authorization:t?"Bearer ".concat(t):""}})})).then((function(){a=t(e).subscribe({next:n.next.bind(n),error:n.error.bind(n),complete:n.complete.bind(n)})})).catch(n.error.bind(n)),function(){a&&a.unsubscribe()}}))})),Ce=new l.a({link:m.a.from([new E.a({accessTokenField:"accessToken",isTokenValidOrUndefined:function(){var e=h();if(!e)return!0;try{var t=y()(e).exp;return!(Date.now()>=1e3*t)}catch(n){return!1}},fetchAccessToken:function(){return fetch("http://localhost:4000/refresh_token",{method:"POST",credentials:"include"})},handleFetch:function(e){g(e)},handleError:function(e){console.warn("Your refresh token is invalid. Try to relogin"),console.error(e)}}),Object(u.a)((function(e){var t=e.graphQLErrors,n=e.networkError;console.log(t),console.log(n)})),Se,new s.a({uri:"http://localhost:4000/graphql",credentials:"include"})]),cache:xe});i.a.render(r.a.createElement(p.a,{client:Ce},r.a.createElement((function(){var e=Object(a.useState)(!0),t=Object(N.a)(e,2),n=t[0],c=t[1];return Object(a.useEffect)((function(){fetch("http://localhost:4000/refresh_token",{method:"POST",credentials:"include"}).then(function(){var e=Object(O.a)(w.a.mark((function e(t){var n,a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.json();case 2:n=e.sent,a=n.accessToken,g(a),c(!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),n?r.a.createElement(z,null):r.a.createElement(je,null)}),null)),document.getElementById("root"))}},[[135,1,2]]]);
//# sourceMappingURL=main.82d58eb6.chunk.js.map